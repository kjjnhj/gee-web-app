<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>鄱阳湖水体分析系统</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { padding: 20px; }
    .header h1 { margin-bottom: 10px; }
    .status-error { color: red; margin-bottom: 10px; }
    .status-info { color: green; margin-bottom: 10px; }
    .dashboard { display: flex; gap: 20px; flex-wrap: wrap; }
    .card { flex: 1; min-width: 300px; height: 400px; border: 1px solid #ccc; padding: 10px; }
    select, button { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>鄱阳湖水体分析系统</h1>
      <div id="status" class="status-info">系统初始化中...</div>
    </div>
    <div class="dashboard">
      <div class="card" id="map"></div>
      <div class="card controls">
        <label for="yearRange">选择年份：</label><br />
        <select id="yearRange"></select><br />
        <button id="analyze-btn" disabled>开始分析</button><br />
        <button id="visualize-btn" disabled>显示当年水体</button>
      </div>
    </div>
  </div>

  <!-- Google API 与 Earth Engine 初始化 -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    let eeLoaded = false;

    function loadEarthEngine() {
      gapi.load('client', () => {
        gapi.client.load('https://earthengine.googleapis.com/earthengine/v1alpha', 'v1', () => {
          const script = document.createElement('script');
          script.src = 'https://earthengine.googleapis.com/earthengine.js';
          script.onload = () => {
            eeLoaded = true;
            initApp();
          };
          document.head.appendChild(script);
        });
      });
    }

    function initializeYearRange() {
      const yearSelect = document.getElementById('yearRange');
      yearSelect.innerHTML = '';
      const currentYear = new Date().getFullYear();
      for (let year = 2015; year <= currentYear; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
      yearSelect.disabled = false;
      document.getElementById('analyze-btn').disabled = false;
      document.getElementById('visualize-btn').disabled = false;
      const status = document.getElementById('status');
      status.textContent = '初始化完成，可以开始分析！';
      status.className = 'status-info';
    }

    function initApp() {
      if (!eeLoaded || typeof ee === 'undefined') {
        const status = document.getElementById('status');
        status.textContent = 'Earth Engine 加载失败，请检查网络连接。';
        status.className = 'status-error';
        return;
      }

      document.getElementById('status').textContent = '地图加载中...';
      const map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 29.0, lng: 116.3 },
        zoom: 8
      });

      document.getElementById('status').textContent = 'Earth Engine 初始化中...';
      ee.initialize(null, null, () => {
        console.log('Earth Engine 初始化成功');
        initializeYearRange();
      }, (err) => {
        console.error('Earth Engine 初始化失败:', err);
        const status = document.getElementById('status');
        status.textContent = 'Earth Engine 初始化失败！';
        status.className = 'status-error';
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('analyze-btn').addEventListener('click', function() {
        const year = document.getElementById('yearRange').value;
        const status = document.getElementById('status');
        status.textContent = '正在分析 ' + year + ' 年数据...';
        setTimeout(() => {
          status.textContent = year + ' 年数据分析完成。';
          status.className = 'status-info';
        }, 2000);
      });

      document.getElementById('visualize-btn').addEventListener('click', function() {
        const year = document.getElementById('yearRange').value;
        const status = document.getElementById('status');
        status.textContent = '正在加载 ' + year + ' 年水体数据...';
        setTimeout(() => {
          status.textContent = year + ' 年水体数据已加载。';
          status.className = 'status-info';
        }, 2000);
      });
    });

    // 加载 Google Maps
    (function loadGoogleMaps() {
      const script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCNwzyHL8XUS9UW3G9qrZymFVgD7Hqhgpc&callback=loadEarthEngine';
      script.async = true;
      script.defer = true;
      script.onerror = () => {
        const status = document.getElementById('status');
        status.textContent = '地图加载失败，请检查 API Key 和网络连接。';
        status.className = 'status-error';
      };
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>


