<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>鄱阳湖水体分析系统</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { padding: 20px; }
    .header h1 { margin-bottom: 10px; }
    .status-error { color: red; margin-bottom: 10px; }
    .status-info { color: green; margin-bottom: 10px; }
    .dashboard { display: flex; gap: 20px; flex-wrap: wrap; }
    .card { flex: 1; min-width: 300px; height: 400px; border: 1px solid #ccc; padding: 10px; }
    select, button { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>鄱阳湖水体分析系统</h1>
      <div id="status" class="status-info">系统初始化中...</div>
    </div>
    <div class="dashboard">
      <div class="card" id="map"></div>
      <div class="card controls">
        <label for="yearRange">选择年份：</label><br />
        <select id="yearRange"></select><br />
        <button id="analyze-btn" disabled>开始分析</button><br />
        <button id="visualize-btn" disabled>显示当年水体</button>
      </div>
    </div>
  </div>

  <!-- 加载 Google Maps 并显示 MapTile 图层 -->
  <script>
    function initializeYearRange() {
      const yearSelect = document.getElementById('yearRange');
      yearSelect.innerHTML = '';
      const currentYear = new Date().getFullYear();
      for (let year = 2015; year <= currentYear; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
      yearSelect.disabled = false;
      document.getElementById('analyze-btn').disabled = false;
      document.getElementById('visualize-btn').disabled = false;
      const status = document.getElementById('status');
      status.textContent = '初始化完成，可以开始分析！';
      status.className = 'status-info';
    }

    let map;

    // 可根据年份匹配 mapId 和 token 的映射对象（替换为你实际的 mapId 和 token）
  const mapLayersByYear = {
    2016: {
      mapid: "projects/ee-lkls031201/maps/2cf1a3f2c2be59fa4276ab4c672da6c9-7fd4aa65e2f3fb21963da19b5b0acd68",
      token: ""
    },
    2017: {
      mapid: "projects/ee-lkls031201/maps/3b02f373a01877c2037899dae82e599a-d4bd2a9e10c22653c6b994b779e07a8f",
      token: ""
    },
    2018: {
      mapid: "projects/ee-lkls031201/maps/efa5a0e7cee4d4d3a1f8b7572e9cee40-cfd134e5ebbcc6d2daa2cd4d4c2872ff",
      token: ""
    },
    2019: {
      mapid: "projects/ee-lkls031201/maps/5c216ea052aca02b42264e0e8af55871-ea1b3f015710045aff2c523072c29597",
      token: ""
    },
    2020: {
      mapid: "projects/ee-lkls031201/maps/a5ebf35a43beba2946f68ef1827e0ff5-b224af8515bd3d2a84975412914dc22e",
      token: ""
    },
    2021: {
      mapid: "projects/ee-lkls031201/maps/4d4db515e356bf7d1b1a9c96ca592ba9-fa25614489fde4f46c359bbc0ef28d6b",
      token: ""
    },
    2022: {
      mapid: "projects/ee-lkls031201/maps/662e95ede4d64cd68c9ba6ad741bb4e9-6f290807bd528b29ee2006aeeb922491",
      token: ""
    }
  };


    function initApp() {
      const status = document.getElementById('status');
      status.textContent = '地图加载中...';
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 29.0, lng: 116.3 },
        zoom: 8
      });

      initializeYearRange();
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('analyze-btn').addEventListener('click', function() {
        const year = document.getElementById('yearRange').value;
        const status = document.getElementById('status');
        status.textContent = '正在分析 ' + year + ' 年数据...';
        setTimeout(() => {
          status.textContent = year + ' 年数据分析完成。';
          status.className = 'status-info';
        }, 2000);
      });

      document.getElementById('visualize-btn').addEventListener('click', function() {
        const year = document.getElementById('yearRange').value;
        const layer = mapLayersByYear[year];
        const status = document.getElementById('status');

        if (!layer) {
          status.textContent = '未找到 ' + year + ' 年的图层信息，请联系管理员更新配置。';
          status.className = 'status-error';
          return;
        }

        const tileUrl = `https://earthengine.googleapis.com/map/${layer.mapid}/{z}/{x}/{y}` + (layer.token ? `?token=${layer.token}` : '');

        map.overlayMapTypes.clear();
        const geeOverlay = new google.maps.ImageMapType({
          getTileUrl: function(coord, zoom) {
            return tileUrl.replace('{x}', coord.x).replace('{y}', coord.y).replace('{z}', zoom);
          },
          tileSize: new google.maps.Size(256, 256),
          name: year + '年水体图',
          opacity: 0.6
        });
        map.overlayMapTypes.push(geeOverlay);

        status.textContent = year + ' 年水体图层已加载。';
        status.className = 'status-info';
      });
    });

    // 加载 Google Maps 并设置回调
    (function loadGoogleMaps() {
      const script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCNwzyHL8XUS9UW3G9qrZymFVgD7Hqhgpc&callback=initApp';
      script.async = true;
      script.defer = true;
      script.onerror = () => {
        const status = document.getElementById('status');
        status.textContent = '地图加载失败，请检查 API Key 和网络连接。';
        status.className = 'status-error';
      };
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>

